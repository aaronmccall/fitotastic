/*
Built using Kango - Cross-browser extension framework
http://kangoextensions.com/
*/
var kangoContentNotificationStatus={NEW:0,VISIBLE:1,HIDDEN:2},Event=function(){function a(b){b=b||window.event;if(!b.isFixed){b.isFixed=!0;b.preventDefault=b.preventDefault||function(){this.returnValue=!1};b.stopPropagation=b.stopPropagaton||function(){this.cancelBubble=!0};b.target||(b.target=b.srcElement);if(!b.relatedTarget&&b.fromElement)try{b.relatedTarget=b.fromElement==b.target?b.toElement:b.fromElement}catch(c){}if(null==b.pageX&&null!=b.clientX){var a=document.documentElement,f=document.body;
b.pageX=b.clientX+(a&&a.scrollLeft||f&&f.scrollLeft||0)-(a.clientLeft||0);b.pageY=b.clientY+(a&&a.scrollTop||f&&f.scrollTop||0)-(a.clientTop||0)}!b.which&&b.button&&(b.which=b.button&1?1:b.button&2?3:b.button&4?2:0)}var a=this.custom_universal_events[b.type],g;for(g in a)!1===a[g].call(this,b)&&(b.preventDefault(),b.stopPropagation())}var c=0;return{add:function(b,d,e){b.setInterval&&(b!=window&&!b.frameElement)&&(b=window);e.guid||(e.guid=++c);b.custom_universal_events||(b.custom_universal_events=
{},b.handle=function(c){if("undefined"!==typeof Event)return a.call(b,c)});b.custom_universal_events[d]||(b.custom_universal_events[d]={},b.addEventListener?b.addEventListener(d,b.handle,!1):b.attachEvent&&b.attachEvent("on"+d,b.handle));b.custom_universal_events[d][e.guid]=e},remove:function(b,a,c){var f=b.custom_universal_events&&b.custom_universal_events[a];if(f){delete f[c.guid];for(var g in f)return;b.removeEventListener?b.removeEventListener(a,b.handle,!1):b.detachEvent&&b.detachEvent("on"+
a,b.handle);delete b.custom_universal_events[a];for(g in b.custom_universal_events)return;delete b.handle;delete b.custom_universal_events}}}}(),domHelper=function(){var a={Fragment:function(){this.initialize(arguments)}};a.Fragment.prototype={initialize:function(){this._frag=document.createDocumentFragment();this._nodes=[]},appendSource:function(a){var b=document.createElement("div");b.innerHTML=a;for(a=0;a<b.childNodes.length;a++){var d=b.childNodes[a].cloneNode(!0);this._nodes.push(d);this._frag.appendChild(d)}},
appendTo:function(a){a&&a.appendChild(this._frag)},insertAsFirst:function(a){a&&a.insertBefore(this._frag,a.firstChild)},insertBefore:function(a,b){a&&b&&a.insertBefore(this._frag,b)},reclaim:function(){for(var a=0;a<this._nodes.length;a++)this._frag.appendChild(this._nodes[a])}};a.appendHtmlToElement=function(c,b){var d=new a.Fragment;d.appendSource(b);d.appendTo(c)};a.insertHtmlAsFirstElement=function(c,b){var d=new a.Fragment;d.appendSource(b);d.insertAsFirst(c)};a.removeAllChilds=function(a){"string"==
typeof a&&(a=document.getElementById(a));if("undefined"==typeof a||null==a)return!1;for(;a.hasChildNodes();)a.removeChild(a.firstChild);return!0};return a}(),sizeHelper=function(){return{clientSize:function(){var a=document,c=document.getElementsByTagName("body")[0];return{width:(null==a.compatMode||"undefined"==typeof a.compatMode||"CSS1Compat"==a.compatMode)&&a.documentElement&&a.documentElement.clientWidth||c&&c.clientWidth,height:(null==a.compatMode||"undefined"==typeof a.compatMode||"CSS1Compat"==
a.compatMode)&&a.documentElement&&a.documentElement.clientHeight||c&&c.clientHeight}},scrollOffset:function(){var a=document,c=document.getElementsByTagName("body")[0];return{left:a.documentElement&&a.documentElement.scrollLeft||c&&c.scrollLeft,top:a.documentElement&&a.documentElement.scrollTop||c&&c.scrollTop}},scrollSize:function(){var a=document,c=document.getElementsByTagName("body")[0];return{width:a.documentElement&&a.documentElement.scrollWidth||c&&c.scrollWidth,height:a.documentElement&&a.documentElement.scrollHeight||
c&&c.scrollHeight}}}}();function getTemplate(a,c){kango.xhr.send({url:"kango-ui/"+a+".tmpl",mimeType:"text/plain"},function(a){c(a.response)})}
var cssHelper=function(){var a={hasClass:function(a,b){return null==a?!1:a.className.match(RegExp("(\\s|^)"+b+"(\\s|$)"))},addClass:function(c,b){null!=c&&!a.hasClass(c,b)&&(c.className+=" "+b)},removeClass:function(c,b){null!=c&&a.hasClass(c,b)&&(c.className=c.className.replace(RegExp("(\\s|^)"+b+"(\\s|$)")," "))},addCss:function(a,b){if(!b||!document.getElementById(b)){var d=document.createElement("style");d.type="text/css";b&&(d.id=b);d.styleSheet?d.styleSheet.cssText=a:d.appendChild(document.createTextNode(a));
var e=null,f=document.getElementsByTagName("head");0<f.length?e=f[0]:(f=document.getElementsByTagName("body"),0<f.length&&(e=f[0]));null!=e&&e.appendChild(d)}}};return a}(),appendHtmlToElement=function(a,c){var b=new domHelper.Fragment;b.appendSource(c);b.appendTo(a)};
function KangoContentNotification(a,c){this.id=a.id;this._htmlTemplate=c;this._hideTimeout=a.hideTimeout||0;this.bDoNotBindContentClick=a.bDoNotBindContentClick;this.width=a.width||"300px";this._hideTimer=null;this.elementWidth=this.elementHeight=this.elementTop=this.elementLeft=0;this.status=kangoContentNotificationStatus.NEW;this._createNotificationElement(a);this.calculateOwnSize();this._bindEnevts()}
KangoContentNotification.prototype._createNotificationElement=function(a){var c=this._htmlTemplate.replace(/{id}/gi,this.id),c=c.replace("{iconUrl}",a.icon||"data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw=="),c=c.replace("{caption}",a.caption),c=c.replace("{title}",a.title),c=c.replace("{text}",a.text);appendHtmlToElement(document.getElementsByTagName("body")[0],c);document.getElementById(this.id).style.width=this.width};
KangoContentNotification.prototype.destroyNotificationElement=function(){var a=document.getElementById(this.id);a.parentNode.removeChild(a)};
KangoContentNotification.prototype._bindEnevts=function(){var a=document.getElementById(this.id),c=this;!0!==this.bDoNotBindContentClick&&Event.add(a,"click",function(a){kango.dispatchMessage("KangoNotification_click",c.id);a.stopPropagation();a.preventDefault()});a=document.getElementById(this.id+"_close");Event.add(a,"click",function(a){c.close();a.stopPropagation();a.preventDefault()})};
KangoContentNotification.prototype.calculateOwnSize=function(){var a=document.getElementById(this.id);this.elementHeight=a.offsetHeight;this.elementWidth=a.offsetWidth};KangoContentNotification.prototype.setPosition=function(a,c){this.elementLeft=a;this.elementTop=c;var b=document.getElementById(this.id);b.style.left=this.elementLeft+"px";b.style.top=this.elementTop+"px"};
KangoContentNotification.prototype.show=function(){var a=document.getElementById(this.id);cssHelper.addClass(a,"kg-content-notification-shown");this.status=kangoContentNotificationStatus.VISIBLE;0!==this._hideTimeout&&this._startHideTimeout();kango.dispatchMessage("KangoNotification_show",this.id)};KangoContentNotification.prototype.hide=function(){var a=document.getElementById(this.id);a&&(a.style.display="none");this.status=kangoContentNotificationStatus.HIDDEN};
KangoContentNotification.prototype.close=function(){this.hide();kango.dispatchMessage("KangoNotification_close",this.id)};KangoContentNotification.prototype._startHideTimeout=function(){var a=this;this._hideTimer=window.setTimeout(function(){a.hide()},this._hideTimeout)};
var contentNotificationManager={_notificationTemplate:"",_notifications:[],recalculatePositions:function(){for(var a=sizeHelper.clientSize(),c=a.height,b=0,d=this._notifications.length;b<d;b+=1){var e=this._notifications[b];e.calculateOwnSize();c-=e.elementHeight+10;e.setPosition(a.width-e.elementWidth-10,c)}},_removeAllHiddenNotifications:function(){for(var a=this._notifications.length-1;0<=a;a-=1)this._notifications[a].status===kangoContentNotificationStatus.HIDDEN&&(this._notifications[a].destroyNotificationElement(),
this._notifications.splice(a,1))},createNotification:function(a){this._removeAllHiddenNotifications();a=new KangoContentNotification(a,this._notificationTemplate);this._notifications.push(a);this.recalculatePositions();return a},closeNotification:function(a){for(var c=0;c<this._notifications.length;c++){var b=this._notifications[c];b.id==a&&b.close()}this.rearrangeNotifications()},rearrangeNotifications:function(){this._removeAllHiddenNotifications();this.recalculatePositions()},init:function(){var a=
this;getTemplate("contentNotification",function(c){a._notificationTemplate=c;getTemplate("contentNotificationStyle",function(b){cssHelper.addCss(b);kango.addMessageListener("KangoNotifications_show",function(a){contentNotificationManager.createNotification(a.data).show()});kango.addMessageListener("KangoNotifications_close",function(b){a.closeNotification(b.data)});kango.addMessageListener("KangoNotifications_rearrange",function(){a.rearrangeNotifications()})})})}};window==window.top&&contentNotificationManager.init();
